
var schooltimes = {
    "09/01/2025": false,
    "09/02/2025": true,
    "09/03/2025": true,
    "09/04/2025": true,
    "09/05/2025": true,
    "09/06/2025": false,
    "09/07/2025": false,
    "09/08/2025": true,
    "09/09/2025": true,
    "09/10/2025": true,
    "09/11/2025": true,
    "09/12/2025": true,
    "09/13/2025": false,
    "09/14/2025": false,
    "09/15/2025": true,
    "09/16/2025": true,
    "09/17/2025": true,
    "09/18/2025": true,
    "09/19/2025": true,
    "09/20/2025": false,
    "09/21/2025": false,
    "09/22/2025": true,
    "09/23/2025": true,
    "09/24/2025": true,
    "09/25/2025": true,
    "09/26/2025": true,
    "09/27/2025": false,
    "09/28/2025": false,
    "09/29/2025": true,
    "09/30/2025": true,

    "10/01/2025": true,
    "10/02/2025": true,
    "10/03/2025": true,
    "10/04/2025": false,
    "10/05/2025": false,
    "10/06/2025": true,
    "10/07/2025": true,
    "10/08/2025": true,
    "10/09/2025": true,
    "10/10/2025": true,
    "10/11/2025": false,
    "10/12/2025": false,
    "10/13/2025": false,
    "10/14/2025": true,
    "10/15/2025": true,
    "10/16/2025": true,
    "10/17/2025": true,
    "10/18/2025": false,
    "10/19/2025": false,
    "10/20/2025": true,
    "10/21/2025": true,
    "10/22/2025": true,
    "10/23/2025": true,
    "10/24/2025": true,
    "10/25/2025": false,
    "10/26/2025": false,
    "10/27/2025": true,
    "10/28/2025": true,
    "10/29/2025": true,
    "10/30/2025": true,
    "10/31/2025": true,

    "11/01/2025": false,
    "11/02/2025": false,
    "11/03/2025": true,
    "11/04/2025": false,
    "11/05/2025": true,
    "11/06/2025": true,
    "11/07/2025": true,
    "11/08/2025": false,
    "11/09/2025": false,
    "11/10/2025": true,
    "11/11/2025": false,
    "11/12/2025": true,
    "11/13/2025": true,
    "11/14/2025": true,
    "11/15/2025": false,
    "11/16/2025": false,
    "11/17/2025": true,
    "11/18/2025": true,
    "11/19/2025": true,
    "11/20/2025": true,
    "11/21/2025": true,
    "11/22/2025": false,
    "11/23/2025": false,
    "11/24/2025": true,
    "11/25/2025": true,
    "11/26/2025": false,
    "11/27/2025": false,
    "11/28/2025": false,
    "11/29/2025": false,
    "11/30/2025": false,

    "12/01/2025": true,
    "12/02/2025": true,
    "12/03/2025": true,
    "12/04/2025": true,
    "12/05/2025": true,
    "12/06/2025": false,
    "12/07/2025": false,
    "12/08/2025": true,
    "12/09/2025": true,
    "12/10/2025": true,
    "12/11/2025": true,
    "12/12/2025": true,
    "12/13/2025": false,
    "12/14/2025": false,
    "12/15/2025": true,
    "12/16/2025": true,
    "12/17/2025": true,
    "12/18/2025": true,
    "12/19/2025": true,
    "12/20/2025": false,
    "12/21/2025": false,
    "12/22/2025": true,
    "12/23/2025": true,
    "12/24/2025": false,
    "12/25/2025": false,
    "12/26/2025": false,
    "12/27/2025": false,
    "12/28/2025": false,
    "12/29/2025": false,
    "12/30/2025": false,
    "12/31/2025": false,
    
    "01/01/2026": false,
    "01/02/2026": false,
    "01/03/2026": false,
    "01/04/2026": false,
    "01/05/2026": true,
    "01/06/2026": true,
    "01/07/2026": true,
    "01/08/2026": true,
    "01/09/2026": true,
    "01/10/2026": false,
    "01/11/2026": false,
    "01/12/2026": true,
    "01/13/2026": true,
    "01/14/2026": true,
    "01/15/2026": true,
    "01/16/2026": true,
    "01/17/2026": false,
    "01/18/2026": false,
    "01/19/2026": false,
    "01/20/2026": true,
    "01/21/2026": true,
    "01/22/2026": true,
    "01/23/2026": true,
    "01/24/2026": false,
    "01/25/2026": false,
    "01/26/2026": true,
    "01/27/2026": true,
    "01/28/2026": true,
    "01/29/2026": true,
    "01/30/2026": true,
    "01/31/2026": false,

    "02/01/2026": false,
    "02/02/2026": true,
    "02/03/2026": true,
    "02/04/2026": true,
    "02/05/2026": true,
    "02/06/2026": true,
    "02/07/2026": false,
    "02/08/2026": false,
    "02/09/2026": true,
    "02/10/2026": true,
    "02/11/2026": true,
    "02/12/2026": true,
    "02/13/2026": true,
    "02/14/2026": false,
    "02/15/2026": false,
    "02/16/2026": false,
    "02/17/2026": false,
    "02/18/2026": false,
    "02/19/2026": false,
    "02/20/2026": false,
    "02/21/2026": false,
    "02/22/2026": false,
    "02/23/2026": true,
    "02/24/2026": true,
    "02/25/2026": true,
    "02/26/2026": true,
    "02/27/2026": true,
    "02/28/2026": false,

    "03/01/2026": false,
    "03/02/2026": true,
    "03/03/2026": true,
    "03/04/2026": true,
    "03/05/2026": true,
    "03/06/2026": true,
    "03/07/2026": false,
    "03/08/2026": false,
    "03/09/2026": true,
    "03/10/2026": true,
    "03/11/2026": true,
    "03/12/2026": true,
    "03/13/2026": true,
    "03/14/2026": false,
    "03/15/2026": false,
    "03/16/2026": true,
    "03/17/2026": true,
    "03/18/2026": true,
    "03/19/2026": true,
    "03/20/2026": true,
    "03/21/2026": false,
    "03/22/2026": false,
    "03/23/2026": true,
    "03/24/2026": true,
    "03/25/2026": true,
    "03/26/2026": true,
    "03/27/2026": true,
    "03/28/2026": false,
    "03/29/2026": false,
    "03/30/2026": true,
    "03/31/2026": true,

    "04/01/2026": true,
    "04/02/2026": true,
    "04/03/2026": true,
    "04/04/2026": false,
    "04/05/2026": false,
    "04/06/2026": true,
    "04/07/2026": true,
    "04/08/2026": true,
    "04/09/2026": true,
    "04/10/2026": true,
    "04/11/2026": false,
    "04/12/2026": false,
    "04/13/2026": true,
    "04/14/2026": true,
    "04/15/2026": true,
    "04/16/2026": true,
    "04/17/2026": true,
    "04/18/2026": false,
    "04/19/2026": false,
    "04/20/2026": false,
    "04/21/2026": false,
    "04/22/2026": false,
    "04/23/2026": false,
    "04/24/2026": false,
    "04/25/2026": false,
    "04/26/2026": false,
    "04/27/2026": true,
    "04/28/2026": true,
    "04/29/2026": true,
    "04/30/2026": true,

    "05/01/2026": true,
    "05/02/2026": false,
    "05/03/2026": false,
    "05/04/2026": true,
    "05/05/2026": true,
    "05/06/2026": true,
    "05/07/2026": true,
    "05/08/2026": true,
    "05/09/2026": false,
    "05/10/2026": false,
    "05/11/2026": true,
    "05/12/2026": true,
    "05/13/2026": true,
    "05/14/2026": true,
    "05/15/2026": true,
    "05/16/2026": false,
    "05/17/2026": false,
    "05/18/2026": true,
    "05/19/2026": true,
    "05/20/2026": true,
    "05/21/2026": true,
    "05/22/2026": true,
    "05/23/2026": false,
    "05/24/2026": false,
    "05/25/2026": false,
    "05/26/2026": true,
    "05/27/2026": true,
    "05/28/2026": true,
    "05/29/2026": true,
    "05/30/2026": false,
    "05/31/2026": false,

    "06/01/2026": true,
    "06/02/2026": true,
    "06/03/2026": true,
    "06/04/2026": true,
    "06/05/2026": true,
    "06/06/2026": false,
    "06/07/2026": false,
    "06/08/2026": true,
    "06/09/2026": true,
    "06/10/2026": true,
    "06/11/2026": true,
    "06/12/2026": true
}

var schedulenormal = {
    A: { start: "07:45", end: "08:45" },
    B: { start: "08:48", end: "09:48" },
    C: { start: "09:51", end: "10:51" },
    D: { start: "10:54", end: "12:24" },
    E: { start: "12:27", end: "13:27" },
    F: { start: "13:30", end: "14:30" }
};

var schedulelate = {
    A: { start: "08:45", end: "09:33" },
    B: { start: "09:36", end: "10:24" },
    C: { start: "10:27", end: "11:15" },
    D: { start: "11:18", end: "12:48" },
    E: { start: "12:51", end: "13:39" },
    F: { start: "13:42", end: "14:30" }
};

var lunchnormal = {
    1: { start: "10:54", end: "11:24" },
    2: { start: "11:24", end: "11:54" },
    3: { start: "11:54", end: "12:24" },
    4: { start: "12:27", end: "12:57" }
}

var lunchlate = {
    1: { start: "11:18", end: "11:48" },
    2: { start: "11:48", end: "12:18" },
    3: { start: "12:18", end: "12:48" },
    4: { start: "12:51", end: "13:21" }
}

// GLOBAL STATE

var lunchSelection = 0;

// MOCK CONTROLS
var mockDate = "11/19/2025"; // MM/DD/YYYY
var mockTime = "08:55";      // HH:MM

// OPERATIONS

function getNow() {
    if(mockDate === "" || mockTime === "") {
        return new Date();
    }

    var dParts = mockDate.split("/");
    var tParts = mockTime.split(":");

    return new Date(
        parseInt(dParts[2], 10),
        parseInt(dParts[0], 10) - 1,
        parseInt(dParts[1], 10),
        parseInt(tParts[0], 10),
        parseInt(tParts[1], 10),
        0,
        0
    );
}

function timeToMinutes(timeStr) {
    var parts = timeStr.split(":");
    return (parseInt(parts[0], 10) * 60) + parseInt(parts[1], 10);
}


/* ===========================
   LUNCH BUTTON UI
=========================== */

function setLunchPeriod(period) {
    lunchSelection = period;

    updateLunchButton(1);
    updateLunchButton(2);
    updateLunchButton(3);
    updateLunchButton(4);

    updateDisplay();
}

function updateLunchButton(num) {
    var el = document.getElementById("lunch" + num);
    var active = (lunchSelection === num);

    el.style.backgroundImage = active
        ? "linear-gradient(#303030, #902020)"
        : "linear-gradient(#503030, #202020)";

    el.style.boxShadow = active
        ? "0 0 0 1px #000000, inset 1px 1px 4px #FFFFFFA0, inset -3px -3px 4px #000000, 0 0 18px #000000"
        : "0 0 0 1px #000000, inset 3px 3px 4px #000000, inset -1px -1px 4px #FFFFFFA0, 0 0 18px #000000";

    el.style.color = active ? "#FFFFFF" : "#C0C0C0";
}


/* ===========================
   BLOCK CALCULATION
=========================== */

function getCurrentBlockAndTime(lunch, schedule, lunchSchedule) {
    var now = getNow();
    var currentMinutes = (now.getHours() * 60) + now.getMinutes();

    var block;
    for (block in schedule) {
        var start = timeToMinutes(schedule[block].start);
        var end = timeToMinutes(schedule[block].end);

        if (currentMinutes >= start && currentMinutes < end) {
            if (block === "D") {
            return handleDBlock(lunch, currentMinutes, start, end, lunchSchedule);
            }

            if (block === "E" && lunch === 4) {
                return handleELunch(currentMinutes, start, end, lunchSchedule);
            }

            return makeResult(
                block,
                end - currentMinutes,
                currentMinutes - start,
                end - start
            );
        }
    }

    return makeResult("Passing time", 0, 0, 0);
}

function handleDBlock(lunch, nowMin, start, end, lunchSchedule) {
    var ls, elapsed, total;

    if (lunch === 1) {
        ls = lunchSchedule[1];

        // During lunch
        if (nowMin < timeToMinutes(ls.end)) {
            elapsed = nowMin - timeToMinutes(ls.start);
            total = timeToMinutes(ls.end) - timeToMinutes(ls.start);
            return makeResult("Lunch", total - elapsed, elapsed, total);
        }

        // AFTER lunch → D block starts fresh here
        elapsed = nowMin - timeToMinutes(ls.end);
        total = end - timeToMinutes(ls.end);
        return makeResult("D", total - elapsed, elapsed, total);
    }


    if (lunch === 2) {
        ls = lunchSchedule[2];
        if (nowMin < timeToMinutes(ls.start)) {
            elapsed = nowMin - start;
            total = timeToMinutes(ls.start) - start;
            return makeResult("D1", total - elapsed, elapsed, total);
        }
        if (nowMin < timeToMinutes(ls.end)) {
            elapsed = nowMin - timeToMinutes(ls.start);
            total = timeToMinutes(ls.end) - timeToMinutes(ls.start);
            return makeResult("Lunch", total - elapsed, elapsed, total);
        }
        elapsed = nowMin - timeToMinutes(ls.end);
        total = end - timeToMinutes(ls.end);
        return makeResult("D2", total - elapsed, elapsed, total);
    }

    if (lunch === 3) {
        ls = lunchSchedule[3];
        if (nowMin >= timeToMinutes(ls.start)) {
            elapsed = nowMin - timeToMinutes(ls.start);
            total = timeToMinutes(ls.end) - timeToMinutes(ls.start);
            return makeResult("Lunch", total - elapsed, elapsed, total);
        }
        elapsed = nowMin - start;
        total = timeToMinutes(ls.start) - start;
        return makeResult("D", total - elapsed, elapsed, total);
    }

    elapsed = nowMin - start;
    total = end - start;
    return makeResult("D+", total - elapsed, elapsed, total);
}

function handleELunch(nowMin, start, end, lunchSchedule) {
    var ls = lunchSchedule[4];
    var elapsed, total;

    // First half of E → Lunch
    if (nowMin < timeToMinutes(ls.end)) {
        elapsed = nowMin - timeToMinutes(ls.start);
        total = timeToMinutes(ls.end) - timeToMinutes(ls.start);
        return makeResult("Lunch", total - elapsed, elapsed, total);
    }

    // After lunch → shortened E
    elapsed = nowMin - timeToMinutes(ls.end);
    total = end - timeToMinutes(ls.end);
    return makeResult("E", total - elapsed, elapsed, total);
}

function makeResult(block, remaining, elapsed, total) {
    return {
        currentBlock: block,
        timeRemaining: remaining,
        timeElapsed: elapsed,
        totalDuration: total
    };
}


// SCHOOL DAYS COUNT

function calculateSchoolDaysLeft() {
    var today = getNow();
    today.setHours(0, 0, 0, 0);

    var daysLeft = 0;
    var isTodaySchoolDay = false;

    var key;
    for (key in schooltimes) {
        var p = key.split("/");
        var d = new Date(
            parseInt(p[2], 10),
            parseInt(p[0], 10) - 1,
            parseInt(p[1], 10)
        );

        if (d.toDateString() === today.toDateString()) {
            isTodaySchoolDay = schooltimes[key];
        }

        if (d >= today && schooltimes[key]) {
            daysLeft++;
        }
    }

    return {
        daysLeft: daysLeft,
        isTodaySchoolDay: isTodaySchoolDay
    };
}


/* ===========================
   DISPLAY UPDATE
=========================== */

function updateDisplay() {
    var now = getNow();
    var schoolInfo = calculateSchoolDaysLeft();

    document.getElementById("schoolsec").style.visibility = "hidden";
    document.getElementById("classinfotxt").innerHTML = "There is no school today";

    if (schoolInfo.isTodaySchoolDay && lunchSelection > 0) {
        document.getElementById("classinfotxt").innerHTML = "Class Information";
        document.getElementById("schoolsec").style.visibility = "visible";
    }


    if (lunchSelection > 0) {
        var isLateDay = (now.getDay() === 3); // Wednesday

        var data = isLateDay
            ? getCurrentBlockAndTime(lunchSelection, schedulelate, lunchlate)
            : getCurrentBlockAndTime(lunchSelection, schedulenormal, lunchnormal);

        var percent = data.totalDuration
            ? Math.round((data.timeElapsed / data.totalDuration) * 100)
            : 0;

        document.getElementById("blockd").innerHTML = data.currentBlock;
        document.getElementById("minleft").innerHTML = data.timeRemaining;
        document.getElementById("classp").innerHTML = percent + "%";
        document.getElementById("cl1").innerHTML = data.timeElapsed;
        document.getElementById("cl2").innerHTML = data.totalDuration;
    }

    var completed = 180 - schoolInfo.daysLeft;
    var yearPercent = Math.round((completed / 180) * 100);

    document.getElementById("pr1").innerHTML = completed;
    document.getElementById("pr2").innerHTML = "180";
    document.getElementById("yearp").innerHTML = yearPercent + "%";
    document.getElementById("daysleft").innerHTML = schoolInfo.daysLeft;

    var quarter = 1;
    if (completed > 45) quarter = 2;
    if (completed > 90) quarter = 3;
    if (completed > 135) quarter = 4;

    document.getElementById("quartert").innerHTML = quarter;
}


setInterval(updateDisplay, 1000);
updateDisplay();